<view class="container">
  <view class="header">
    <text class="title">任务申请和时间线功能测试</text>
    <text class="subtitle">完整流程测试工具</text>
  </view>

  <!-- 用户信息 -->
  <view class="user-info">
    <text class="label">当前用户：</text>
    <text class="value">{{user.nickName || '未登录'}}</text>
  </view>

  <!-- 操作按钮 -->
  <view class="actions">
    <button 
      class="btn btn-primary" 
      bindtap="initDatabase"
      disabled="{{loading}}"
    >
      初始化数据库
    </button>
    
    <button 
      class="btn btn-success" 
      bindtap="startFullTest"
      disabled="{{loading}}"
    >
      开始完整测试
    </button>
    
    <button 
      class="btn btn-info" 
      bindtap="goToApplications"
    >
      查看申请管理
    </button>
    
    <button 
      class="btn btn-info" 
      bindtap="goToTimeline"
      disabled="{{!testTaskId}}"
    >
      查看任务时间线
    </button>
    
    <button 
      class="btn btn-warning" 
      bindtap="cleanupTestData"
    >
      清理测试数据
    </button>
    
    <button 
      class="btn btn-secondary" 
      bindtap="clearResults"
    >
      清空结果
    </button>
  </view>

  <!-- 测试状态 -->
  <view wx:if="{{testDemandId || testApplicationId || testTaskId}}" class="test-status">
    <view class="status-title">测试状态</view>
    <view wx:if="{{testDemandId}}" class="status-item">
      <text class="status-label">测试需求ID：</text>
      <text class="status-value">{{testDemandId}}</text>
    </view>
    <view wx:if="{{testApplicationId}}" class="status-item">
      <text class="status-label">测试申请ID：</text>
      <text class="status-value">{{testApplicationId}}</text>
    </view>
    <view wx:if="{{testTaskId}}" class="status-item">
      <text class="status-label">测试任务ID：</text>
      <text class="status-value">{{testTaskId}}</text>
    </view>
  </view>

  <!-- 加载状态 -->
  <view wx:if="{{loading}}" class="loading">
    <text>测试进行中...</text>
  </view>

  <!-- 测试结果 -->
  <view wx:if="{{testResults.length > 0}}" class="results">
    <view class="results-title">测试结果</view>
    <view 
      wx:for="{{testResults}}" 
      wx:key="index" 
      class="result-item result-{{item.type}}"
    >
      <view class="result-content">
        <text class="result-message">{{item.message}}</text>
        <text class="result-time">{{item.time}}</text>
      </view>
    </view>
  </view>

  <!-- 使用说明 -->
  <view class="instructions">
    <view class="instructions-title">使用说明</view>
    <view class="instruction-item">
      <text class="step">1.</text>
      <text class="desc">首先点击"初始化数据库"确保所有集合已创建</text>
    </view>
    <view class="instruction-item">
      <text class="step">2.</text>
      <text class="desc">点击"开始完整测试"运行自动化测试流程</text>
    </view>
    <view class="instruction-item">
      <text class="step">3.</text>
      <text class="desc">测试完成后可以点击"查看申请管理"和"查看任务时间线"验证界面</text>
    </view>
    <view class="instruction-item">
      <text class="step">4.</text>
      <text class="desc">测试完成后建议点击"清理测试数据"清除测试记录</text>
    </view>
  </view>
</view>