# 云函数部署指南

## 🎯 是否需要重新部署？

### 检查当前状态

根据您的项目情况，以下云函数**可能需要重新部署**：

| 云函数 | 状态 | 是否需要部署 | 原因 |
|--------|------|-------------|------|
| `task` | ✅ 已更新 | 🔴 **需要** | 新增了任务申请、审批、时间线功能 |
| `initDatabase` | ✅ 已更新 | 🔴 **需要** | 更新了数据库集合创建逻辑 |
| `login` | ✅ 稳定 | 🟡 建议 | 确保最新版本 |
| `sms` | ✅ 稳定 | 🟢 可选 | 如果短信功能正常可不部署 |

## 🚀 部署步骤

### 方法一：通过微信开发者工具（推荐）

1. **打开微信开发者工具**
   ```
   手动启动微信开发者工具
   导入项目：e:\trae_owd\project_wx
   ```

2. **部署关键云函数**
   - 右键点击 `cloudfunctions/task` → 选择"上传并部署：云端安装依赖"
   - 右键点击 `cloudfunctions/initDatabase` → 选择"上传并部署：云端安装依赖"
   - 右键点击 `cloudfunctions/login` → 选择"上传并部署：云端安装依赖"

3. **验证部署结果**
   - 在云开发控制台查看云函数列表
   - 确认版本更新时间

### 方法二：批量部署

1. **选择所有云函数**
   - 在微信开发者工具中选择 `cloudfunctions` 文件夹
   - 右键选择"上传并部署：云端安装依赖（不上传node_modules）"

2. **等待部署完成**
   - 观察控制台输出
   - 确认所有云函数部署成功

## 📋 部署优先级

### 🔴 高优先级（必须部署）
- **`task`** - 包含所有任务相关的新功能
- **`initDatabase`** - 数据库初始化功能

### 🟡 中优先级（建议部署）
- **`login`** - 用户登录功能

### 🟢 低优先级（可选部署）
- **`sms`** - 短信功能（如果不使用可跳过）

## 🔍 部署后验证

### 1. 功能测试
使用测试页面验证：
```
pages/test-task-flow/test-task-flow
```

### 2. 数据库测试
使用数据库状态检查：
```
pages/test-db-status/test-db-status
```

### 3. 核心功能验证
- [ ] 任务申请功能正常
- [ ] 任务审批功能正常
- [ ] 时间线功能正常
- [ ] 数据库初始化正常

## ⚠️ 注意事项

### 部署前检查
- [ ] 确保网络连接正常
- [ ] 确认云开发环境已激活
- [ ] 检查云函数代码无语法错误

### 部署中注意
- [ ] 选择"云端安装依赖"而不是"仅上传代码"
- [ ] 等待部署完全完成再进行下一个
- [ ] 观察控制台是否有错误信息

### 部署后验证
- [ ] 在云开发控制台确认版本更新
- [ ] 运行测试页面验证功能
- [ ] 检查日志是否有异常

## 🛠️ 常见问题

### Q: 部署失败怎么办？
**A:** 
1. 检查网络连接
2. 确认云开发环境状态
3. 查看具体错误信息
4. 重试部署

### Q: 部署后功能不正常？
**A:**
1. 检查云函数日志
2. 确认数据库权限
3. 验证用户登录状态
4. 运行测试页面诊断

### Q: 需要部署多长时间？
**A:**
- 单个云函数：1-3分钟
- 全部云函数：5-10分钟
- 首次部署可能更长

## 📊 部署检查清单

### 部署前
- [ ] 微信开发者工具已打开
- [ ] 项目已正确导入
- [ ] 云开发环境已激活
- [ ] 网络连接正常

### 部署中
- [ ] `task` 云函数部署成功
- [ ] `initDatabase` 云函数部署成功
- [ ] `login` 云函数部署成功
- [ ] 无部署错误信息

### 部署后
- [ ] 云函数版本已更新
- [ ] 测试页面功能正常
- [ ] 数据库状态正常
- [ ] 核心功能可用

---

## 🎯 快速行动建议

**立即需要做的：**

1. **打开微信开发者工具**
2. **重新部署 `task` 和 `initDatabase` 云函数**
3. **运行测试页面验证功能**

这两个云函数包含了所有新开发的任务申请和时间线功能，必须重新部署才能正常使用！