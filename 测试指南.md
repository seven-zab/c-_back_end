# 任务申请和时间线功能测试指南

## 测试准备

### 1. 启动微信开发者工具
1. 打开微信开发者工具
2. 导入项目：选择 `e:\trae_owd\project_wx` 目录
3. 确保云开发环境已配置

### 2. 数据库状态检查
导航到测试页面：`pages/test-db-status/test-db-status`

**检查项目：**
- ✅ demands 集合
- ✅ task_applications 集合  
- ✅ tasks 集合
- ✅ messages 集合
- ✅ users 集合
- ✅ contacts 集合
- ✅ sms_codes 集合

如果有集合不存在，点击"初始化数据库"按钮。

## 完整功能测试

### 方法一：使用自动化测试页面
导航到：`pages/test-task-flow/test-task-flow`

**测试步骤：**
1. 点击"初始化数据库"确保所有集合已创建
2. 点击"开始完整测试"运行自动化测试流程
3. 观察测试结果，确保所有步骤都成功
4. 点击"查看申请管理"验证申请管理界面
5. 点击"查看任务时间线"验证时间线界面
6. 测试完成后点击"清理测试数据"

### 方法二：手动测试流程

#### 步骤1：创建测试需求
1. 导航到：`pages/demand/create`
2. 填写需求信息：
   - 标题：测试需求
   - 内容：这是一个测试需求
   - 类型：选择任意类型
   - 位置：选择任意位置
3. 提交需求

#### 步骤2：申请任务
1. 导航到需求详情页面
2. 点击"申请任务"按钮
3. 填写申请理由
4. 提交申请

#### 步骤3：管理申请（发布者视角）
1. 导航到：`pages/task/applications`
2. 查看待处理的申请
3. 测试"确认"和"拒绝"功能

#### 步骤4：查看任务时间线（接受者视角）
1. 导航到：`pages/task/timeline`
2. 查看任务详情和时间线
3. 测试标记步骤完成功能
4. 测试联系对方功能

## 测试要点

### 数据库验证
- [ ] 所有必需的集合都已创建
- [ ] 集合权限配置正确
- [ ] 数据写入和读取正常

### 申请流程验证
- [ ] 需求详情页面显示"申请任务"按钮
- [ ] 申请提交成功
- [ ] 申请状态正确更新
- [ ] 通知功能正常

### 审批流程验证
- [ ] 发布者能看到待处理申请
- [ ] 确认申请功能正常
- [ ] 拒绝申请功能正常
- [ ] 状态更新正确

### 时间线功能验证
- [ ] 任务详情显示正确
- [ ] 时间线步骤显示正确
- [ ] 步骤标记功能正常
- [ ] 联系功能正常
- [ ] 取消任务功能正常

## 常见问题

### 1. 云函数调用失败
- 检查云开发环境是否正确配置
- 确保云函数已部署
- 检查网络连接

### 2. 数据库访问失败
- 检查数据库权限配置
- 确保集合已创建
- 检查用户登录状态

### 3. 页面导航失败
- 检查页面路径是否正确
- 确保页面已在 app.json 中注册
- 检查参数传递是否正确

## 测试数据清理

测试完成后，建议清理测试数据：
1. 使用测试页面的"清理测试数据"功能
2. 或手动删除测试创建的记录

## 部署前检查

- [ ] 所有测试用例通过
- [ ] 错误处理正常
- [ ] 用户体验良好
- [ ] 性能表现正常
- [ ] 安全性检查通过